<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <header>
        <i class="arrow"><img src="arrow.png"></i>
        <h5><a href="/main">Задание из 2 Лабораторной работы</a></h5>
    </header>
    <div id="authorsTable"></div>
    <div id="employeeTable"></div>
    <div id="childTable"></div>
    <div id="giftTable"></div>
    <button id="refreshButton">Обновить таблицы</button>
    <form id="employeeForm">
        <input type="text" id="lastname" placeholder="Фамилия" required>
        <input type="text" id="name" placeholder="Имя" required>
        <input type="text" id="middlename" placeholder="Отчество" required>
        <input type="text" id="post" placeholder="Должность" required>
        <input type="text" id="division" placeholder="Отдел" required>
        <input type="date" id="date_of_admission" placeholder="Дата приема" required>
        <button type="submit">Добавить сотрудника</button>
    </form>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/employee')
                .then(response => response.json())
                .then(data => {
                    updateTable(data);
                })
                .catch(error => console.error('Ошибка при получении данных:', error));
        });

        document.addEventListener('DOMContentLoaded', function() {
            fetch('/сhild')
                .then(response => response.json())
                .then(data => {
                    updateTable(data);
                })
                .catch(error => console.error('Ошибка при получении данных:', error));
        });

        document.addEventListener('DOMContentLoaded', function() {
            fetch('/gift')
                .then(response => response.json())
                .then(data => {
                    updateTable(data);
                })
                .catch(error => console.error('Ошибка при получении данных:', error));
        });

        document.getElementById('refreshButton').addEventListener('click', function() {
            fetch('/employee')
                .then(response => response.json())
                .then(data => {
                    updateTable(data);
                })
                .catch(error => console.error('Ошибка при получении данных:', error));
        });

        function updateTable(data) {
            const authors = data[0] || data;
            const table = document.createElement('table');
            const thead = document.createElement('thead');
            const tbody = document.createElement('tbody');
            const headerRow = document.createElement('tr');
            Object.keys(authors[0]).forEach(key => {
                const th = document.createElement('th');
                th.textContent = key;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);
            authors.forEach(author => {
                const row = document.createElement('tr');
                Object.values(author).forEach(value => {
                    const td = document.createElement('td');
                    td.textContent = value;
                    row.appendChild(td);
                });
                tbody.appendChild(row);
            });
            table.appendChild(tbody);

            const authorsTable = document.getElementById('authorsTable');
            while (authorsTable.firstChild) {
                authorsTable.removeChild(authorsTable.firstChild);
            }

            authorsTable.appendChild(table);
        }

        document.getElementById('employeeForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const employeeData = {
                lastname_Employee: document.getElementById('lastname').value,
                name_Employee: document.getElementById('name').value,
                middlename_Employee: document.getElementById('middlename').value,
                post_Employee: document.getElementById('post').value,
                division_Employee: document.getElementById('division').value,
                date_of_admission: document.getElementById('date_of_admission').value
            };

            fetch('/employee', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(employeeData),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html>
